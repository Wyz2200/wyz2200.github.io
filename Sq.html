<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>手機版記帳簿 v11</title>
<style>
:root{
  --bg-1:#efe6dc;
  --bg-2:#e2d2c0;
  --card-bg:rgba(255,255,255,0.18);
  --card-border:rgba(255,255,255,0.25);
  --accent:rgba(48,41,38,0.95);
  --accent-soft:rgba(48,41,38,0.65);
  --success:#2ecc71;
  --danger:#e74c3c;
  --glass-blur:14px;
  --btn-bg: rgba(160,120,255,0.8);
  --btn-color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial;
}
html,body{
  margin:0;
  padding:0;
  min-height:100vh;
  overflow-y:auto;
  background:linear-gradient(160deg,var(--bg-1) 0%,var(--bg-2) 100%);
  color:var(--accent);
}
main{
  max-width:480px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  gap:20px;
  padding:16px;
}
.panel{
  position:relative;
  background: var(--card-bg);
  border-radius:20px;
  padding:16px;
  box-shadow:0 10px 30px rgba(17,12,10,0.12);
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
  border:1px solid var(--card-border);
  overflow:hidden;
  transition: all .35s ease;
}
header h1{margin:0 0 6px;font-size:20px;}
header p{margin:0;font-size:13px;color:var(--accent-soft);}
.balance{margin-top:12px;}
.balance .big{font-size:26px;font-weight:700;}
.balance .small{font-size:13px;color:var(--accent-soft);}
form{display:flex;flex-direction:column;gap:10px;margin-top:14px;}
label{display:flex; flex-direction:column; font-size:13px; margin-bottom:6px; margin-left:14px; font-weight:600; color:#111;} /* 右移 label */
input,select{
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,0.06);
  background: rgba(255,255,255,0.6);
  font-size:14px;
}
button.btn{
  padding:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.25);
  font-weight:600;
  cursor:pointer;
  background: linear-gradient(180deg, var(--btn-bg), rgba(160,120,255,0.6));
  color: var(--btn-color);
  filter: brightness(1.1);
  transition: all .2s ease;
}
button.btn:hover{ filter: brightness(1.25); }
.tx{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
  padding:12px;
  border-radius:14px;
  background:linear-gradient(180deg,rgba(255,255,255,0.25),rgba(255,255,255,0.12));
  border:1px solid rgba(255,255,255,0.25);
  margin-bottom:12px;
  opacity:0;
  transform:translateY(10px) scale(0.97);
  filter:blur(6px);
  animation: fadeIn .5s ease forwards;
  position: relative;
}
.tx .meta{flex:1; display:flex; flex-direction:column; gap:8px;}
.tx .title{font-weight:700;margin-bottom:4px;}
.tx .desc{font-size:13px;color:var(--accent-soft);}
.amount{min-width:70px;text-align:right;font-weight:700;}
.amount.positive{color:var(--success);}
.amount.negative{color:var(--danger);}
.tag{
  display:inline-block;
  padding:2px 8px;
  border-radius:12px;
  font-size:12px;
  margin-left:6px;
  background: rgba(255,255,255,0.40); /* 稍微深一點 */
  color:var(--accent-soft);
  position: relative;
  top: -2px; /* 上移 */
}
.tx button{position: relative; top: -6px;} /* 編輯 / 刪除按鈕上移 */
.empty{text-align:center;color:var(--accent-soft);padding:16px;}
input.customCategoryInput{
  width:50%;
  display:inline-block;
  margin-left:0;
  margin-top:6px;
}
.flex-row{display:flex; gap:10px; flex-wrap:wrap;}
.flex-row > label{flex:1;}
@keyframes fadeIn{
  to{opacity:1; transform:translateY(0) scale(1); filter:blur(0);}
}
</style>
</head>
<body>
<main>
<section class="panel">
<header>
  <h1>手機版記帳簿</h1>
  <p>Vision Pro 毛玻璃風格</p>
</header>
<div class="balance">
  <div class="small">餘額</div>
  <div class="big" id="balance">NT$ 0</div>
</div>
<form id="txForm">
  <label>標題<input type="text" id="title" placeholder="標題" required></label>
  <div class="flex-row">
    <label>金額<input type="number" id="amount" placeholder="金額" required min="0" step="0.01"></label>
    <label>日期<input id="date" type="date"></label>
  </div>
  <div class="flex-row">
    <label>類別
      <select id="category">
        <option value="餐飲">餐飲</option>
        <option value="交通">交通</option>
        <option value="購物">購物</option>
        <option value="收入">收入</option>
        <option value="其他">其他</option>
        <option value="自訂">自訂</option>
      </select>
      <input type="text" id="customCategory" class="customCategoryInput" placeholder="請輸入自訂類別" style="display:none;">
    </label>
    <label>類型
      <select id="type">
        <option value="expense">支出</option>
        <option value="income">收入</option>
      </select>
    </label>
  </div>
  <label>備註<input type="text" id="note" placeholder="備註"></label>
  <button type="submit" class="btn">新增</button>
</form>
</section>

<section class="panel" id="txList"></section>
<div id="empty" class="empty">目前沒有記錄</div>
</main>

<script>
const STORAGE_KEY="mobile_card_edit_v11";
let transactions=[];
let editingIndex = null;

function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(transactions))}
function load(){transactions=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]")}
function fmt(n){return "NT$ "+n.toLocaleString()}

// 日期預設今天
function setTodayDate(){
  const dateInput=document.getElementById("date");
  if(dateInput){
    const today=new Date().toISOString().split("T")[0];
    dateInput.value=today;
  }
}

document.addEventListener("DOMContentLoaded", ()=>{
  setTodayDate();
  load();render();
});

function render(){
  const list=document.getElementById("txList");
  list.innerHTML="";
  if(transactions.length===0){document.getElementById("empty").style.display="block";}
  else{document.getElementById("empty").style.display="none";}
  let bal=0;
  transactions.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="tx";
    const sign = t.type==="income" ? "+" : "-";
    div.innerHTML=`
      <div class="meta" id="meta-${i}">
        <div class="title">${t.title}<span class="tag">${t.category}</span></div>
        <div class="desc">${t.note||""} ${t.date||""}</div>
      </div>
      <div class="amount ${t.type==="income"?"positive":"negative"}">${sign} ${fmt(t.amount)}</div>
      <div style="display:flex;gap:6px;">
        <button onclick="toggleEdit(${i})" style="border:none;background:none;color:#bfa8ff;font-size:20px;cursor:pointer;">✎</button>
        <button onclick="removeTx(${i})" style="border:none;background:none;color:#999;font-size:18px;cursor:pointer;">✕</button>
      </div>
    `;
    list.appendChild(div);
    bal += t.type==="income"? t.amount : -t.amount;
  });
  document.getElementById("balance").textContent = fmt(bal); // 餘額不顯示 +/-
}

// 類別自訂顯示
document.getElementById("category").addEventListener("change",()=>{
  const val=document.getElementById("category").value;
  document.getElementById("customCategory").style.display=val==="自訂"?"inline-block":"none";
});

// 新增交易
document.getElementById("txForm").addEventListener("submit",e=>{
  e.preventDefault();
  let category=document.getElementById("category").value;
  if(category==="自訂") category=document.getElementById("customCategory").value || "自訂";
  const t={
    title:title.value,
    amount:Number(amount.value),
    note:note.value,
    category,
    type:type.value,
    date:date.value
  };
  transactions.unshift(t);
  save();render();
  e.target.reset();
  setTodayDate();
});

// 切換編輯 / 收回
function toggleEdit(index){
  if(editingIndex === index){
    editingIndex = null;
    render();
    return;
  }
  editingIndex = index;
  const div=document.getElementById("txList").children[index];
  const t=transactions[index];
  const meta=div.querySelector(`#meta-${index}`);
  meta.innerHTML=`
    <label>標題<input type="text" id="title-${index}" value="${t.title}"></label>
    <div class="flex-row">
      <label>金額<input type="number" id="amount-${index}" value="${t.amount}"></label>
      <label>日期<input type="date" id="date-${index}" value="${t.date||''}"></label>
    </div>
    <div class="flex-row">
      <label>類別
        <select id="category-${index}">
          <option value="餐飲">餐飲</option>
          <option value="交通">交通</option>
          <option value="購物">購物</option>
          <option value="收入">收入</option>
          <option value="其他">其他</option>
          <option value="自訂">自訂</option>
        </select>
        <input type="text" id="custom-${index}" class="customCategoryInput" placeholder="請輸入自訂類別" style="display:none;">
      </label>
      <label>類型<select id="type-${index}">
        <option value="expense">支出</option>
        <option value="income">收入</option>
      </select></label>
    </div>
    <label>備註<input type="text" id="note-${index}" value="${t.note}"></label>
    <button onclick="saveCard(${index})" class="btn" style="margin-top:6px;">儲存</button>
  `;
  const catSelect=meta.querySelector(`#category-${index}`);
  if(["餐飲","交通","購物","收入","其他"].includes(t.category)){
    catSelect.value=t.category;
  } else {
    catSelect.value="自訂";
    meta.querySelector(`#custom-${index}`).style.display="inline-block";
    meta.querySelector(`#custom-${index}`).value=t.category;
  }
  catSelect.addEventListener("change",()=>{
    const cinput=meta.querySelector(`#custom-${index}`);
    if(catSelect.value==="自訂"){cinput.style.display="inline-block";}
    else{cinput.style.display="none";}
  });
}

// 儲存編輯
function saveCard(index){
  const div=document.getElementById("txList").children[index];
  const meta=div.querySelector(`#meta-${index}`);
  const title=meta.querySelector(`#title-${index}`).value;
  const amount=Number(meta.querySelector(`#amount-${index}`).value);
  const note=meta.querySelector(`#note-${index}`).value;
  const type=meta.querySelector(`#type-${index}`).value;
  let category=meta.querySelector(`#category-${index}`).value;
  if(category==="自訂") category=meta.querySelector(`#custom-${index}`).value||"自訂";
  const date=meta.querySelector(`#date-${index}`).value;
  transactions[index]={title,amount,note,category,type,date};
  editingIndex = null;
  save();render();
}

// 刪除交易
function removeTx(index){
  const t = transactions[index];
  if(confirm(`確認要刪除 "${t.title}" 這筆交易嗎？`)){
    transactions.splice(index,1);
    if(editingIndex===index) editingIndex=null;
    save();
    render();
  }
}
</script>
</body>
</html>
