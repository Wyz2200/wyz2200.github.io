<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>記帳本</title>
<style>
  body{
    margin:0;
    font-family:sans-serif;
    background:#d2b48c;
    backdrop-filter:blur(20px);
    -webkit-backdrop-filter:blur(20px);
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .card{
    width:90%;
    max-width:420px;
    background:rgba(255,255,255,0.15);
    border:1px solid rgba(255,255,255,0.25);
    border-radius:16px;
    padding:16px;
    margin:10px 0;
    backdrop-filter:blur(15px);
    -webkit-backdrop-filter:blur(15px);
    box-shadow:0 4px 20px rgba(0,0,0,0.2);
    animation:fadeIn .3s ease;
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
  h2{margin:0 0 12px 0;font-size:18px;}
  input,select,textarea{
    width:100%;
    padding:8px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.2);
    background:rgba(255,255,255,0.2);
    color:#fff;
    outline:none;
  }
  textarea{resize:vertical;}
  .btn{
    padding:10px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.25); /* 微白邊框 */
    font-weight:600;
    cursor:pointer;
    background: linear-gradient(180deg, rgba(160,120,255,0.8), rgba(160,120,255,0.6));
    color:#fff;
    filter: brightness(1.1);
    transition:all .2s ease;
  }
  .btn:hover{filter:brightness(1.25);}
  .list .tx{
    background:linear-gradient(180deg,rgba(255,255,255,0.25),rgba(255,255,255,0.15));
    border-radius:12px;
    padding:12px;
    margin:8px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
    transition:all .3s ease;
  }
  .list .tx .meta{flex:1;}
  .list .tx .title{font-weight:bold;}
  .list .tx .tag{
    font-size:12px;
    margin-left:6px;
    padding:2px 6px;
    border-radius:8px;
    background:rgba(255,255,255,0.3);
  }
  .list .tx .amount{font-weight:bold;margin-left:10px;}
  .positive{color:#a8ffa8;}
  .negative{color:#ff9b9b;}
</style>
</head>
<body>
  <div class="card">
    <h2>新增記帳</h2>
    <label>標題</label>
    <input id="title" placeholder="項目名稱">
    
    <div style="display:flex;gap:6px;">
      <div style="flex:1;">
        <label>金額</label>
        <input id="amount" type="number" placeholder="金額">
      </div>
      <div style="flex:1;">
        <label>日期</label>
        <input id="date" type="date">
      </div>
    </div>
    
    <div style="display:flex;gap:6px;">
      <div style="flex:1;">
        <label>類別</label>
        <select id="category" onchange="toggleCustomCat(this)">
          <option value="餐飲">餐飲</option>
          <option value="交通">交通</option>
          <option value="娛樂">娛樂</option>
          <option value="購物">購物</option>
          <option value="自訂">自訂</option>
        </select>
      </div>
      <div style="flex:1;">
        <label>類型</label>
        <select id="type">
          <option value="expense">支出</option>
          <option value="income">收入</option>
        </select>
      </div>
    </div>

    <input id="customCat" placeholder="輸入自訂類別" style="display:none;width:50%;margin-top:6px;">

    <label>備註</label>
    <textarea id="note" placeholder="備註..."></textarea>
    
    <button class="btn" onclick="addTx()">＋ 新增</button>
  </div>

  <div class="card">
    <h2>記錄</h2>
    <div class="list" id="list"></div>
    <div style="margin-top:10px;">餘額: <span id="balance">0</span></div>
  </div>

<script>
let transactions=[];

function toggleCustomCat(sel){
  document.getElementById("customCat").style.display= sel.value==="自訂"?"block":"none";
}

function addTx(){
  const title=document.getElementById("title").value.trim();
  let amt=parseFloat(document.getElementById("amount").value);
  const date=document.getElementById("date").value;
  const catSel=document.getElementById("category").value;
  const cat=catSel==="自訂"?document.getElementById("customCat").value:catSel;
  const type=document.getElementById("type").value;
  const note=document.getElementById("note").value.trim();
  if(!title||isNaN(amt))return alert("請輸入完整資料");
  transactions.push({title,amount:amt,date,category:cat,type,note});
  render();
  clearForm();
}

function clearForm(){
  document.getElementById("title").value="";
  document.getElementById("amount").value="";
  document.getElementById("note").value="";
  document.getElementById("category").value="餐飲";
  document.getElementById("customCat").style.display="none";
  document.getElementById("customCat").value="";
  document.getElementById("type").value="expense";
  document.getElementById("date").value=new Date().toISOString().split('T')[0];
}

function render(){
  const list=document.getElementById("list");
  list.innerHTML="";
  let bal=0;
  transactions.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="tx";
    div.innerHTML=`
      <div class="meta" id="meta-${i}">
        <div class="title">${t.title}<span class="tag">${t.category}</span></div>
        <div class="desc">${t.note||""} ${t.date||""}</div>
      </div>
      <div class="amount ${t.type==="income"?"positive":"negative"}">${t.amount}</div>
      <div style="display:flex;gap:6px;">
        <button onclick="editCard(${i})" style="border:none;background:none;color:#bfa8ff;font-size:16px;cursor:pointer;">✎</button>
        <button onclick="removeTx(${i})" style="border:none;background:none;color:#999;font-size:18px;cursor:pointer;">✕</button>
      </div>
    `;
    list.appendChild(div);
    bal += t.type==="income"? t.amount : -t.amount;
  });
  document.getElementById("balance").innerText=bal;
}

function editCard(i){
  const t=transactions[i];
  const meta=document.getElementById("meta-"+i);
  meta.innerHTML=`
    <div>
      <label>標題</label>
      <input id="e-title-${i}" value="${t.title}">
      <label>金額</label>
      <input id="e-amount-${i}" type="number" value="${t.amount}">
      <label>日期</label>
      <input id="e-date-${i}" type="date" value="${t.date}">
      <label>類別</label>
      <input id="e-cat-${i}" value="${t.category}">
      <label>類型</label>
      <select id="e-type-${i}">
        <option value="expense" ${t.type==="expense"?"selected":""}>支出</option>
        <option value="income" ${t.type==="income"?"selected":""}>收入</option>
      </select>
      <label>備註</label>
      <textarea id="e-note-${i}">${t.note}</textarea>
      <button class="btn" onclick="saveEdit(${i})">儲存</button>
    </div>
  `;
}

function saveEdit(i){
  transactions[i]={
    title:document.getElementById("e-title-"+i).value,
    amount:parseFloat(document.getElementById("e-amount-"+i).value),
    date:document.getElementById("e-date-"+i).value,
    category:document.getElementById("e-cat-"+i).value,
    type:document.getElementById("e-type-"+i).value,
    note:document.getElementById("e-note-"+i).value
  };
  render();
}

function removeTx(i){
  if(confirm("確定要刪除此筆記錄嗎？")){
    transactions.splice(i,1);
    render();
  }
}

// 預設日期 = 今天
document.getElementById("date").value=new Date().toISOString().split('T')[0];
</script>
</body>
</html>
